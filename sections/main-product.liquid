{% comment %}
  Main Product Section
  Includes product information and mockup builder for personalized products
{% endcomment %}

{% liquid
  assign show_mockup_builder = false
  
  # Check if this product supports personalization
  if product.tags contains 'personalization' or product.tags contains 'ppt-'
    assign show_mockup_builder = true
  endif
  
  # Check if we're on a personalization template
  if template contains 'product-personalization' or template contains 'ppt-'
    assign show_mockup_builder = true
  endif
-%}

<script type="application/ld+json">
  {{ product | structured_data }}
</script>

<div class="section-background color-background-1"></div>
<div class="main-product section section--page-width spacing-style color-background-1 relative">
  
  <div class="main-product__grid">
    
    <!-- Product Media -->
    <div class="main-product__media">
      {%- if product.media.size > 0 -%}
        <div class="product-media-gallery">
          {%- for media in product.media -%}
            <div class="product-media-item">
              {%- case media.media_type -%}
                {%- when 'image' -%}
                  <img 
                    src="{{ media | image_url: width: 600 }}" 
                    alt="{{ media.alt | escape }}"
                    loading="lazy"
                    width="{{ media.width }}"
                    height="{{ media.height }}"
                  />
                {%- when 'external_video' -%}
                  {{ media | external_video_tag }}
                {%- when 'video' -%}
                  {{ media | video_tag: controls: true }}
                {%- when 'model' -%}
                  {{ media | model_viewer_tag }}
              {%- endcase -%}
            </div>
          {%- endfor -%}
        </div>
      {%- endif -%}
    </div>
    
    <!-- Product Details -->
    <div class="main-product__details">
      
      <!-- Product Title -->
      <h1 class="main-product__title">{{ product.title }}</h1>
      
      <!-- Product Price -->
      <div class="main-product__price">
        {%- if product.compare_at_price > product.price -%}
          <span class="main-product__price--compare">{{ product.compare_at_price | money }}</span>
        {%- endif -%}
        <span class="main-product__price--current">{{ product.price | money }}</span>
      </div>
      
      <!-- Product Description -->
      {%- if product.description != blank -%}
        <div class="main-product__description">
          {{ product.description }}
        </div>
      {%- endif -%}
      
      <!-- Product Form -->
      <form 
        action="/cart/add" 
        method="post" 
        enctype="multipart/form-data" 
        class="main-product__form"
        data-product-form
      >
        <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
        
        <!-- Variant Options -->
        {%- unless product.has_only_default_variant -%}
          <div class="main-product__variants">
            {%- for option in product.options_with_values -%}
              <div class="main-product__variant-group">
                <label class="main-product__variant-label">{{ option.name }}</label>
                <div class="main-product__variant-options">
                  {%- for value in option.values -%}
                    <input 
                      type="radio" 
                      name="options[{{ option.name }}]" 
                      value="{{ value }}"
                      id="option-{{ option.name | handleize }}-{{ value | handleize }}"
                      {% if option.selected_value == value %}checked{% endif %}
                      data-variant-id="{{ product.selected_or_first_available_variant.id }}"
                    />
                    <label for="option-{{ option.name | handleize }}-{{ value | handleize }}">
                      {{ value }}
                    </label>
                  {%- endfor -%}
                </div>
              </div>
            {%- endfor -%}
          </div>
        {%- endunless -%}
        
        <!-- Quantity -->
        <div class="main-product__quantity">
          <label for="quantity">Quantity</label>
          <input 
            type="number" 
            id="quantity" 
            name="quantity" 
            value="1" 
            min="1" 
            class="main-product__quantity-input"
          />
        </div>
        
        <!-- Add to Cart Button -->
        <button 
          type="submit" 
          name="add" 
          class="main-product__add-to-cart"
          {% unless product.available %}disabled{% endunless %}
        >
          {%- if product.available -%}
            Add to Cart
          {%- else -%}
            Sold Out
          {%- endif -%}
        </button>
      </form>
      
    </div>
    
  </div>
  
  <!-- Mockup Builder -->
  {%- if show_mockup_builder -%}
    <div class="main-product__mockup-builder">
      {% render 'mockup-builder' %}
    </div>
  {%- endif -%}
  
</div>

<style>
  .main-product {
    padding: 2rem 0;
  }
  
  .main-product__grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 3rem;
    margin-bottom: 3rem;
  }
  
  .main-product__media {
    position: relative;
  }
  
  .product-media-gallery {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  
  .product-media-item img {
    width: 100%;
    height: auto;
    border-radius: 8px;
  }
  
  .main-product__title {
    font-size: 2rem;
    font-weight: 600;
    margin: 0 0 1rem 0;
  }
  
  .main-product__price {
    margin-bottom: 1.5rem;
  }
  
  .main-product__price--compare {
    text-decoration: line-through;
    color: #666;
    margin-right: 0.5rem;
  }
  
  .main-product__price--current {
    font-size: 1.5rem;
    font-weight: 600;
    color: #000;
  }
  
  .main-product__description {
    margin-bottom: 2rem;
    line-height: 1.6;
  }
  
  .main-product__form {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }
  
  .main-product__variants {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  
  .main-product__variant-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
  
  .main-product__variant-label {
    font-weight: 500;
    color: #333;
  }
  
  .main-product__variant-options {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }
  
  .main-product__variant-options input[type="radio"] {
    display: none;
  }
  
  .main-product__variant-options label {
    padding: 0.5rem 1rem;
    border: 2px solid #ddd;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .main-product__variant-options input[type="radio"]:checked + label {
    border-color: #000;
    background: #000;
    color: #fff;
  }
  
  .main-product__quantity {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
  
  .main-product__quantity-input {
    padding: 0.75rem;
    border: 2px solid #ddd;
    border-radius: 4px;
    width: 100px;
  }
  
  .main-product__add-to-cart {
    padding: 1rem 2rem;
    background: #000;
    color: #fff;
    border: none;
    border-radius: 4px;
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.2s ease;
  }
  
  .main-product__add-to-cart:hover {
    background: #333;
  }
  
  .main-product__add-to-cart:disabled {
    background: #ccc;
    cursor: not-allowed;
  }
  
  .main-product__mockup-builder {
    margin-top: 3rem;
    padding-top: 3rem;
    border-top: 1px solid #eee;
  }
  
  @media (max-width: 768px) {
    .main-product__grid {
      grid-template-columns: 1fr;
      gap: 2rem;
    }
    
    .main-product__title {
      font-size: 1.5rem;
    }
    
    .main-product__variant-options {
      flex-direction: column;
    }
    
    .main-product__variant-options label {
      text-align: center;
    }
  }
</style> 